{% load bootstrap3 %}
{% load i18n %}

{% include 'editor/fragment_modal_close.html' %}
<h3>{{ changeset.title }}</h3>
<form method="post" action="{{ request.path }}">
{% csrf_token %}
<p class="text-muted">{{ desc }}{% if changeset.author %} {{ changeset.author.username }}{% endif %}</p>
<p><em>No description</em></p>

<p>
    <a class="btn btn-default btn-xs" href="">
        {% trans 'Edit' %}
    </a>
</p>
{% bootstrap_messages %}

{% for group in grouped_changes %}
    <table class="table table-condensed table-h-bordered change-group">
        <thead>
            <tr>
                <th colspan="3">
                    {% if group.edit_url %}
                        <a class="btn btn-default btn-xs pull-right" data-force-next-zoom href="{{ group.edit_url }}">
                            {% trans 'Edit' %}
                        </a>
                    {% endif %}
                    {% if group.obj_title %}
                        {{ group.obj_title }} <small>({{ group.obj }})</small>
                    {% else %}
                        {{ group.obj }}
                    {% endif %}
                </th>
            </tr>
        </thead>
        <tbody>
            {% for change in group.changes %}
                <tr>
                    <td class="text-{{ change.class }}"><i class="glyphicon glyphicon-{{ change.icon }}"></i></td>
                    <td{% if change.discarded %} class="text-muted"{% endif %}>
                        {% if change.value %}<u>{% else %}<em>{% endif %}{{ change.title }}{% if change.value %}</u>:{% else %}</em>{% endif %}
                        {{ change.value }}
                    </td>
                    <td class="text-muted">
                        {% if change.apply_problem %}
                            <i class="glyphicon glyphicon-alert text-danger" data-toggle="tooltip" data-placement="left" title="{{ change.apply_problem }}"></i>
                        {% elif change.has_no_effect %}
                            <i class="glyphicon glyphicon-ok text-success" data-toggle="tooltip" data-placement="left" title="{% trans 'This change has no effect. You can restore it.' %}"></i>
                        {% endif %}
                        {% if change.author and change.author != changeset.author %}
                            <i class="glyphicon glyphicon-user text-muted" data-toggle="tooltip" data-placement="left" title="{{ change.author.username }}"></i>
                        {% endif %}
                        {% if change.can_restore %}
                            <button type="submit" name="restore" value="{{ change.pk }}" class="btn btn-xs btn-default" data-toggle="tooltip" data-placement="left" title="{% trans 'Restore original state' %}">
                                <i class="glyphicon glyphicon-share-alt"></i>
                            </button>
                        {% endif %}
                        {% if change.created %}
                            <i class="glyphicon glyphicon-time text-muted" data-toggle="tooltip" data-placement="left" title="{{ change.created }}"></i>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endfor %}

{% buttons %}
    <button type="submit" class="btn btn-danger" name="delete" value="1">{% trans 'Delete' %}</button>
    <div class="pull-right">
        <button type="submit" class="btn btn-primary" name="propose" value="1">{% trans 'Propose' %}</button>
    </div>
{% endbuttons %}
</form>
